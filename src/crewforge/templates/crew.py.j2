"""
CrewAI Crew Template - Generated by CrewForge

Main crew orchestration for {{crew_config.name}} crew.
"""

from crewai import Crew, Process
from .agents import {{crew_config.name|title|regex_replace('[^a-zA-Z0-9]', '')}}Agents
from .tasks import {{crew_config.name|title|regex_replace('[^a-zA-Z0-9]', '')}}Tasks
{% set all_tools = [] %}
{% for agent in crew_config.agents %}
  {% if agent.tools %}
    {% for tool in agent.tools %}
      {% if tool not in all_tools %}
        {% set _ = all_tools.append(tool) %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}
{% for task in crew_config.tasks %}
  {% if task.tools %}
    {% for tool in task.tools %}
      {% if tool not in all_tools %}
        {% set _ = all_tools.append(tool) %}
      {% endif %}
    {% endfor %}
  {% endif %}
{% endfor %}
{% if all_tools %}from .tools import {{crew_config.name|title|regex_replace('[^a-zA-Z0-9]', '')}}Tools{% endif %}


class {{crew_config.name|title|regex_replace('[^a-zA-Z0-9]', '')}}Crew:
    """Main crew class orchestrating agents and tasks for {{crew_config.name}}."""

    def __init__(self):
        """Initialize the {{crew_config.name}} crew with agents and tasks."""
        self.agents = {{crew_config.name|title|regex_replace('[^a-zA-Z0-9]', '')}}Agents()
        self.tasks = {{crew_config.name|title|regex_replace('[^a-zA-Z0-9]', '')}}Tasks()
        {% if all_tools %}self.tools = {{crew_config.name|title|regex_replace('[^a-zA-Z0-9]', '')}}Tools(){% endif %}

    def crew(self):
        """Create and return the configured crew."""
        # Initialize agents
{% for agent in crew_config.agents %}
        {{agent.role|lower|regex_replace('[^a-z0-9\s]', '')|replace(' ', '_')|replace('-', '_')}} = self.agents.{{agent.role|lower|regex_replace('[^a-z0-9\s]', '')|replace(' ', '_')|replace('-', '_')}}()
{% endfor %}
        
        # Initialize tasks with agent assignments
{% for task in crew_config.tasks %}
        {{task.description[:50]|lower|regex_replace('[^a-z0-9\s]', '')|replace(' ', '_')|truncate(30, true, '')}} = self.tasks.{{task.description[:50]|lower|regex_replace('[^a-z0-9\s]', '')|replace(' ', '_')|truncate(30, true, '')}}(
            {% for agent in crew_config.agents %}{{agent.role|lower|regex_replace('[^a-z0-9\s]', '')|replace(' ', '_')|replace('-', '_')}}{{ ', ' if not loop.last else '' }}{% endfor %}
        )
{% endfor %}

        return Crew(
            agents=[
                {% for agent in crew_config.agents %}{{agent.role|lower|regex_replace('[^a-z0-9\s]', '')|replace(' ', '_')|replace('-', '_')}}{{ ', ' if not loop.last else '' }}
                {% endfor %}
            ],
            tasks=[
                {% for task in crew_config.tasks %}{{task.description[:50]|lower|regex_replace('[^a-z0-9\s]', '')|replace(' ', '_')|truncate(30, true, '')}}{{ ', ' if not loop.last else '' }}
                {% endfor %}
            ],
            verbose={{crew_config.verbose|lower}},
            process=Process.{{crew_config.process.upper()}},{% if crew_config.max_rpm %}
            max_rpm={{crew_config.max_rpm}},{% endif %}{% if crew_config.full_output %}
            full_output={{crew_config.full_output|lower}},{% endif %}{% if crew_config.language and crew_config.language != "en" %}
            language="{{crew_config.language}}",{% endif %}
        )